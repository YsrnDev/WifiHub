<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Pembayaran Berhasil - WifiHub </title>
    <link rel="stylesheet" href="src/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #F6F1E9 0%, #FFD93D 100%);
            color: #4F200D;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .success-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(79, 32, 13, 0.2);
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            border: 1px solid #4F200D;
        }
        
        .success-icon {
            font-size: 5rem;
            color: #10b981;
            margin-bottom: 20px;
        }
        
        .success-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #4F200D;
        }
        
        .success-message {
            font-size: 1.1rem;
            color: #4F200D;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .btn-primary {
            background-color: #FF9A00;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .btn-primary:hover {
            background-color: #4F200D;
            transform: translateY(-2px);
        }
        
        .order-info {
            background: #fefaf3;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #4F200D20;
        }
        
        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .info-label {
            font-weight: 500;
            color: #4F200D;
        }
        
        .info-value {
            font-weight: 600;
            color: #FF9A00;
        }
        
        @media (max-width: 600px) {
            .success-container {
                padding: 30px 20px;
            }
            
            .success-title {
                font-size: 1.5rem;
            }
            
            .success-icon {
                font-size: 4rem;
            }
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        
        <h1 class="success-title">Pembayaran Berhasil!</h1>
        
        <p class="success-message">
            Terima kasih telah melakukan pembayaran. Paket voucher Anda telah aktif dan siap digunakan.
        </p>
        
        <div class="order-info">
            <div class="info-item">
                <span class="info-label">Status Pembayaran:</span>
                <span class="info-value">Berhasil</span>
            </div>
            <div class="info-item">
                <span class="info-label">ID Pesanan:</span>
                <span class="info-value" id="orderId">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Tanggal:</span>
                <span class="info-value" id="date">-</span>
            </div>
        </div>
        
        <button onclick="goToHomepage()" class="btn-primary">
            <i class="fas fa-home"></i> Kembali ke Beranda
        </button>
        
        <br><br>
        
        <button onclick="goToVoucherPage()" class="btn-primary" style="background-color: #4F200D;">
            <i class="fas fa-ticket-alt"></i> Lihat Voucher Saya
        </button>
    </div>

    <script>
        // Ambil parameter dari URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order_id');
        const statusCode = urlParams.get('status_code');
        const transactionStatus = urlParams.get('transaction_status');
        
        // Tampilkan informasi pesanan jika tersedia
        if (orderId) {
            document.getElementById('orderId').textContent = orderId;
        }
        
        // Tampilkan tanggal sekarang
        const now = new Date();
        document.getElementById('date').textContent = now.toLocaleDateString('id-ID', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        // Log informasi untuk debugging
        console.log('Payment success details:', {
            orderId: orderId,
            statusCode: statusCode,
            transactionStatus: transactionStatus
        });
        
        // Tambahkan delay untuk memberi waktu sistem Midtrans mengirim webhook
        setTimeout(function() {
            // Refresh untuk memastikan status pembayaran sudah diperbarui di sistem
            console.log('Refreshing voucher status...');
        }, 5000); // 5 detik delay sebelum memberi indikasi bahwa status mungkin sudah diperbarui
        
        // Fungsi untuk kembali ke halaman sebelumnya dan menutup tab ini
        function goToHomepage() {
            // Coba fokus ke window utama dulu
            if (window.opener) {
                // Pindah ke halaman utama
                window.opener.location.href = 'index.html';
                // Fokus ke window utama
                window.opener.focus();
            } else {
                // Jika tidak bisa, pindah ke halaman utama di window ini
                window.location.href = 'index.html';
            }
            // Tutup tab pembayaran
            window.close();
        }
        
        function goToVoucherPage() {
            // Coba fokus ke window utama dulu
            if (window.opener) {
                // Pindah ke halaman voucher (bagian Lihat Voucher Saya di index.html)
                window.opener.location.href = 'index.html#pricing';
                // Fokus ke window utama
                window.opener.focus();
            } else {
                // Jika tidak bisa, pindah ke halaman voucher di window ini
                window.location.href = 'index.html#pricing';
            }
            // Tutup tab pembayaran
            window.close();
        }
        
        // Alternatif: jika window.close() tidak bekerja karena kebijakan browser,
        // kita bisa tampilkan pesan untuk menutup tab secara manual
        window.addEventListener('load', function() {
            // Tambahkan event listener untuk tombol close browser
            // Ini sebagai fallback jika window.close() tidak bekerja
            const closeMessage = document.createElement('p');
            closeMessage.textContent = 'Catatan: Anda dapat menutup tab ini sekarang.';
            closeMessage.style.textAlign = 'center';
            closeMessage.style.marginTop = '20px';
            closeMessage.style.color = '#4F200D';
            closeMessage.style.fontStyle = 'italic';
            document.querySelector('.success-container').appendChild(closeMessage);
        });
    </script>
</body>
</html>